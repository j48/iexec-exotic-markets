<!DOCTYPE html>
<html lang="en">

	<head>
			<meta charset="utf-8">
			<title>Decentralized Exotic Prediction Markets</title>
			<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
			<link rel="stylesheet" type="text/css" href="./static/css/style.css"/>
	</head>

	<body>
		<div class="body-logo"></div>
		<header>
				<div class="header-header display-none">
					<div class="header-home noselect">
						<div class="home-element"><img src="./static/img/misc/iexecDeal.png" class="home-logo"></div>
						<div><h3 class="home-element">home</h3></div>
					</div>
				</div>
			<div class="header-wrapper">
				<h1 class="iexec-stroke">Exotic Prediction Markets</h1>
				<h2 class="iexec-stroke">Oracle Factory Edition</h2>

				<div class="header-body">
					<div class="source-logo iexec-stroke">
						<div>
							<h3 class="header-h3">Powered By</h3>
						</div>
						<a class="iexec-link" href="https://iex.ec" target="_blank">
						<img src="./static/img/misc/iexec-white.png" class="iexec-logo">
						</a>
					</div>
				</div>
			</div>
		</header>

		<main>
			<div class="main-wrapper">
                <h2 id="market-title-h2"></h2>

				<div id="orderContainer" class="hide">
					<div class="order-wrapper">

						<div id="web3Connect" class="connect-button connection-inactive">
							<span>Connect Web3 Wallet</span>
						</div>

						<div id="web3Status"></div>

						<div class="input-container">
							<h3 class="iexec-link" >Market Name</h3>
							<input type="text" id="marketName" class="smart-contract-output" maxlength="30" placeholder="Covid-19 vaccines in France" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Over/Under</h3>
							<input type="text" id="marketValue" class="smart-contract-output" maxlength="32" placeholder="155000000" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >After</h3>
							<input type="text" id="marketPayout" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Your Bet (nRLC, in wei for now)</h3>
							<input type="text" id="betAmount" class="smart-contract-input" maxlength="64" >
						</div>
						<div class="input-container">
								<input id="betUnderButton" class="button task-block" type="button" value="Bet Under" disabled onclick=""/>
						</div>
						<div class="input-container">
								<input id="betOverButton" class="button task-block" type="button" value="Bet Over" disabled onclick=""/>
						</div>

					</div>
				</div>
				<div id="tokensContainer" class="hide">
					<div class="order-wrapper">
						<div class="input-container">
							<h3 class="iexec-link" >Your Under Tokens</h3>
							<input type="text" id="underTokens" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
								<input id="underButton" class="button task-block" type="button" value="View Under Tokens" disabled onclick=""/>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Your Over Tokens</h3>
							<input type="text" id="overTokens" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
								<input id="overButton" class="button task-block" type="button" value="View Over Tokens" disabled onclick=""/>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Status</h3>
							<input type="text" id="marketStatus" class="smart-contract-output" maxlength="66" placeholder="0xd3987060257095bfade672042b3b406b1862dc010ce70bd9b37e3bab59020dab" readonly>
						</div>

						<div class="input-container">
								<input id="claimButton" class="button task-block" type="button" value="Claim Payout" disabled onclick=""/>
						</div>

						<div class="input-container">
								<input id="closeButton" class="button task-block" type="button" value="Close Market" disabled onclick=""/>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Result</h3>
							<input type="text" id="marketResult" class="smart-contract-output" maxlength="66" placeholder="0xd3987060257095bfade672042b3b406b1862dc010ce70bd9b37e3bab59020dab" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Start Time</h3>
							<input type="text" id="marketStart" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Betting Stops</h3>
							<input type="text" id="marketStop" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Refund Deadline</h3>
							<input type="text" id="marketRefund" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Creator Drain Time</h3>
							<input type="text" id="marketDrain" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Time Closed</h3>
							<input type="text" id="marketClose" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Oracle ID</h3>
							<input type="text" id="marketOracleId" class="smart-contract-output hex-input" maxlength="64" placeholder="0x" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Oracle URI</h3>
							<input type="text" id="marketOracleUri" class="smart-contract-output hex-input" maxlength="32" placeholder="0" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Creator Address</h3>
							<input type="text" id="marketCreator" class="smart-contract-output" maxlength="64" placeholder="0x" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Pool Amount Left to Claim</h3>
							<input type="text" id="marketClaim" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Total Pool Amount</h3>
							<input type="text" id="marketPool" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Total Bets for Over</h3>
							<input type="text" id="marketBetOver" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

						<div class="input-container">
							<h3 class="iexec-link" >Total Bets for Under</h3>
							<input type="text" id="marketBetUnder" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

					</div>
				</div>

				<div id="oracleContainer" class="hide">
					<h2>Oracle</h2>
					<div class="order-wrapper">
						<div class="input-container">
							<h3 class="iexec-link" >Oracle Value</h3>
							<input type="text" id="marketOracleValue" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>
						<div class="input-container">
							<h3 class="iexec-link" >Oracle Update Time</h3>
							<input type="text" id="marketOracleTime" class="smart-contract-output" maxlength="64" placeholder="0" readonly>
						</div>

						<div class="input-container">
								<input id="updateOracleButton" class="button task-block hide" type="button" value="Update Oracle" disabled onclick=""/>
						</div>

					</div>
				</div>


			</div>
		</main>

		<footer>
			<div class="footer-wrapper">

				<div class="footer-left">
					<div>
						<a class="white-link " href="https://github.com/" target="_blank">
						<img src="./static/img/misc/github.png"  class="github-logo">
						</a>
					</div>
				</div>

				<div class="footer-center">
					<div>
						<a class="iexec-link" href="./markets.html" target="_blank">
						<h2>/home</h2>
						</a>
					</div>
				</div>

				<div class="footer-right">
					<div>
						<a class="white-link " href="https://www.ethdenver.com/" target="_blank">
						<img src="./static/img/misc/eth-denver.png" class="ethdenver-logo">
						</a>
					</div>
				</div>

			</div>
		</footer>

		<script type="text/javascript" src="./static/js/web3/web3.min.js"></script>
		<script type="text/javascript" src="./static/js/app/abi/exoticABI.js"></script>
		<script type="text/javascript" src="./static/js/app/abi/oracleABI.js"></script>

		<script>
			const params = new URLSearchParams(window.location.search);
			const exoticContract = {address: "0x204AA0cC951D38A8E12a1CF70B220c2555c9A016", abi: exoticABI};

			async function init(_params){
				const app = await import("./static/js/app/app.js");
				const market = await import("./static/js/app/market.js");
				const titleContainer = document.getElementById("market-title-h2");

				async function populateMarketData(mId) {
					return app.marketData(exoticContract, mId )
						.then( (results) => {
							return results;
						});
				}

				async function fetchMarket(mId){
					const marketData = await populateMarketData(mId);

					// build table with data
					// console.log(marketData);
					if(marketData.startTime == "0"){
						titleContainer.innerHTML = "Market " + marketId + " does not Exist";
					}else{
						market.load(mId, marketData);
						}


				}

				const marketId = _params.get("id");

				if(Number.isSafeInteger(parseInt(marketId))){
				    titleContainer.innerHTML = "Market " + marketId;
				    // rate-limit?
					try {
						await fetchMarket(marketId);

					} catch (error) {
						const parsedError = {error:error.name,  msg:error.message};
						console.log(parsedError);
						// populate on screen error msg
					}

				} else{
				    titleContainer.innerHTML = "No Market ID Found";
				}

				const ethereumButton = document.getElementById("web3Connect");
				//const showAccount = document.querySelector('.showAccount');

				ethereumButton.addEventListener('click', () => {
				  app.connectMetaMask2();
				});


			}

			init(params);
		</script>

	</body>

</html>

